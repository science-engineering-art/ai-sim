import random
from numpy import Inf

MAX_ITERATIONS = 10000


def get_random_indexes(input_list, k=-1):
    if k < 0:
        k = random.randint(1, len(input_list))
    return list(set(random.choices(range(len(input_list)),
                                   k=k)))


def encode_population(population_set):
    encoded_population_set = []
    for individual in population_set:
        encoded_population_set.append([bin(i)[2:] for i in individual])
    return encoded_population_set


def init_population(pop_size, number_of_turns, maximum_waiting_time, average_passing_time):
    population_set = []

    for i in range(pop_size):
        individual = []
        for j in range(number_of_turns):
            individual.append(random.randint(
                average_passing_time, maximum_waiting_time))

            # individual.append(random.randint(average_passing_time, maximum_waiting_time),  # green time
            #                   random.randint(average_passing_time, maximum_waiting_time))  # red time

        population_set.append(individual)

    return population_set


def eval_individual_in_simulation():
    pass


def fitness():
    pass


def mutate_individual(individual):
    for i in get_random_indexes(individual):
        cromosome = list(individual[i])
        for j in get_random_indexes(cromosome):
            cromosome[j] = '0' if cromosome[j] == '1' else '1'
        individual[i] = "".join(cromosome)


def mutate(encoded_pop_set, mutation_rate):
    for i in get_random_indexes(encoded_pop_set, k=int(
            mutation_rate*len(encoded_pop_set))):
        mutate_individual(encoded_pop_set[i])


def select_parents(population_set, fitness_set):
    avg = 0
    for fitness in fitness_set:
        avg += fitness
    avg = avg / len(fitness_set)

    parents = []
    parents_fitness = []
    for i in range(population_set):
        if fitness_set[i] >= avg:
            parents.append(population_set[i])
            parents_fitness.append(fitness_set[i])

    if len(parents) % 2 != 0:
        i = parents_fitness.index(min(parents_fitness))
        parents.remove(parents[i])
        parents_fitness.remove(parents_fitness[i])
    return parents, parents_fitness, [parents[0:len(parents)/2], parents[len(parents)/2:]]


def multipoint_xover(parent_a, parent_b, p=1):
    offspring = [[], []]

    last = (0, parent_a)  # point, parent
    print(last)

    points = get_random_indexes(parent_a if len(
        parent_a) <= len(parent_b) else parent_b, p)
    points.sort()
    print(points)

    for i in points:
        offspring[0] += last[1][last[0]:i]
        offspring[1] += parent_b[last[0]:i] if last[1] == parent_a else parent_a[last[0]:i]
        last = (i, parent_b if last[1] == parent_a else parent_a)
        print(last)
    offspring[0] += last[1][last[0]:]
    offspring[1] += parent_b[last[0]:] if last[1] == parent_a else parent_a[last[0]:]

    return offspring


def cromosome_xover(individual_a, individual_b):
    pass


def xover(parent_a, parent_b):
    new_population = []
    for i in len(parent_a, parent_b):
        new_population += multipoint_xover(parent_a[i], parent_b[i])
    return new_population


def stop_criterion(i):
    return i >= MAX_ITERATIONS


def evolutionary_algorithm(pop_size, number_of_turns, maximum_waiting_time, average_passing_time):
    population = [init_population(
        pop_size, number_of_turns, maximum_waiting_time, average_passing_time)]

    i = 0

    best_solution = ([], -Inf)

    while not stop_criterion(i):
        fitness = []

        max_f = max(fitness)
        if max_f > best_solution[1]:
            best_solution = (population[i][fitness.index(max_f)], max_f)

        best_solutions, best_solutions_fitness, parents = select_parents(
            population[i], fitness)

        new_population = []
        new_population += best_solutions
        new_population += xover(parents[0], parents[1])
        mutate(new_population)

        population.append(new_population)
        i += 1

    return best_solution[0]

# pop = [[1, 4, 5, 10], [11, 5, 2, 1], [5, 8, 4, 15]]
# bin_p = encode_population(pop)
# print(bin_p)
# mutate(bin_p, 0.5)
# print(bin_p)
# print(get_random_indexes([1, 2, 3, 4, 5], 1))
# print(multipoint_xover("1111", "2222"))


a = [1, -9, -90, 3, 2]
print(a.index(min(a)))
a.remove(a[a.index(min(a))])
print(a)
